# ä½¿ç”¨æŒ‡å— - MCP åŠ å¯†è²¨å¹£äº¤æ˜“ç³»çµ±

## å¿«é€Ÿé–‹å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨å•Ÿå‹•è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
```bash
cd /user_data/1141/aiot/final/mcp_system_final
./start.sh
```

### æ–¹å¼äºŒï¼šæ‰‹å‹•å®‰è£
```bash
# 1. å®‰è£ä¾è³´
pip install -r requirements.txt

# 2. é…ç½®ç’°å¢ƒè®Šæ•¸
cp .env.example .env
# ç·¨è¼¯ .env ä¸¦å¡«å…¥ API å¯†é‘°

# 3. å‰µå»ºæ•¸æ“šç›®éŒ„
mkdir -p data
echo "{}" > data/strategies.json
echo "[]" > data/backtest_results.json

# 4. é‹è¡Œæ‡‰ç”¨
python app.py
```

## ç³»çµ±æ¸¬è©¦

é‹è¡Œæ¸¬è©¦è…³æœ¬ç¢ºèªç³»çµ±çµ„ä»¶æ­£å¸¸ï¼š
```bash
python test_demo.py
```

## åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

### 1. æŸ¥è©¢åŠ å¯†è²¨å¹£åƒ¹æ ¼

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
æŸ¥è©¢ BTC çš„åƒ¹æ ¼
ETH/USDT ç¾åœ¨å¤šå°‘éŒ¢ï¼Ÿ
å‘Šè¨´æˆ‘ SOL çš„å¸‚å ´æ•¸æ“š
```

**é æœŸè¼¸å‡ºï¼š**
- ç•¶å‰åƒ¹æ ¼
- 24å°æ™‚æ¼²è·Œå¹…
- 24å°æ™‚äº¤æ˜“é‡
- æœ€é«˜/æœ€ä½åƒ¹

### 2. æ–°èæƒ…æ„Ÿåˆ†æ

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
åˆ†æ BTC çš„æ–°èæƒ…æ„Ÿ
æœ€è¿‘é—œæ–¼ä»¥å¤ªåŠçš„æ–°èæƒ…ç·’å¦‚ä½•ï¼Ÿ
çµ¦æˆ‘ ETH çš„å¸‚å ´æƒ…ç·’åˆ†æ
```

**é æœŸè¼¸å‡ºï¼š**
- æ•´é«”æƒ…æ„Ÿï¼ˆæ­£é¢/ä¸­æ€§/è² é¢ï¼‰
- æƒ…æ„Ÿåˆ†æ•¸
- åˆ†æçš„æ–°èæ•¸é‡
- å„é¡æƒ…æ„Ÿçš„åˆ†ä½ˆ

**æŠ€è¡“ç´°ç¯€ï¼š**
- ä½¿ç”¨ FinBERT æ¨¡å‹ï¼ˆProsusAI/finbertï¼‰
- é‡å°é‡‘èæ–°èå„ªåŒ–
- æ”¯æ´æ‰¹é‡æ–‡ç« åˆ†æ

### 3. æŠ€è¡“åˆ†æèˆ‡åƒ¹æ ¼é æ¸¬

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
é€²è¡Œ BTC/USDT æŠ€è¡“åˆ†æ
é æ¸¬ ETH çš„åƒ¹æ ¼èµ°å‹¢
å° SOL/USDT åšæŠ€è¡“æŒ‡æ¨™åˆ†æ
```

**é æœŸè¼¸å‡ºï¼š**
- ç•¶å‰åƒ¹æ ¼
- é æ¸¬åƒ¹æ ¼
- é æ¸¬æ¼²è·Œå¹…åº¦
- æŠ€è¡“æŒ‡æ¨™ä¿¡è™Ÿï¼ˆRSI, MACD, Bollinger Bandsç­‰ï¼‰
- äº¤æ˜“å»ºè­°ï¼ˆBUY/SELL/HOLDï¼‰

**ä½¿ç”¨çš„æŠ€è¡“æŒ‡æ¨™ï¼š**
- RSIï¼ˆç›¸å°å¼·å¼±æŒ‡æ¨™ï¼‰
- MACDï¼ˆç§»å‹•å¹³å‡æ”¶æ–‚ç™¼æ•£ï¼‰
- Bollinger Bandsï¼ˆå¸ƒæ—å¸¶ï¼‰
- Stochastic Oscillatorï¼ˆéš¨æ©Ÿéœ‡ç›ªæŒ‡æ¨™ï¼‰
- ATRï¼ˆå¹³å‡çœŸå¯¦æ³¢å¹…ï¼‰
- ADXï¼ˆå¹³å‡è¶¨å‘æŒ‡æ¨™ï¼‰

### 4. ç¶œåˆåˆ†æ

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
å° BTC/USDT é€²è¡Œç¶œåˆåˆ†æ
çµ¦æˆ‘ ETH çš„å®Œæ•´æŠ•è³‡å»ºè­°
å…¨é¢åˆ†æ SOL/USDT çš„æŠ•è³‡æ©Ÿæœƒ
```

**ç¶œåˆåˆ†ææ•´åˆï¼š**
1. **å¸‚å ´æ•¸æ“š**ï¼šç•¶å‰åƒ¹æ ¼ã€äº¤æ˜“é‡
2. **æ–°èæƒ…æ„Ÿ**ï¼šå¸‚å ´æƒ…ç·’æŒ‡æ¨™
3. **æŠ€è¡“åˆ†æ**ï¼šåƒ¹æ ¼é æ¸¬å’ŒæŠ€è¡“ä¿¡è™Ÿ
4. **æŠ•è³‡å»ºè­°**ï¼šSTRONG BUY / BUY / HOLD / SELL / STRONG SELL

**æ±ºç­–æ¬Šé‡ï¼š**
- æ–°èæƒ…æ„Ÿï¼š40%
- æŠ€è¡“åˆ†æï¼š60%

### 5. ç­–ç•¥ç®¡ç†

#### å‰µå»ºæ–°ç­–ç•¥

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
å‰µå»ºä¸€å€‹åç‚ºã€Œè¶¨å‹¢è·Ÿéš¨ã€çš„ç­–ç•¥
æ–°å»ºç­–ç•¥ï¼šåƒ¹å€¼æŠ•è³‡
```

**API èª¿ç”¨ï¼š**
```bash
curl -X POST http://localhost:11403/api/strategies \
  -H "Content-Type: application/json" \
  -d '{
    "name": "my_strategy",
    "config": {
      "type": "sentiment",
      "risk_level": "medium",
      "symbols": ["BTC/USDT", "ETH/USDT"]
    }
  }'
```

#### åˆ—å‡ºæ‰€æœ‰ç­–ç•¥

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
åˆ—å‡ºæ‰€æœ‰ç­–ç•¥
é¡¯ç¤ºæˆ‘çš„äº¤æ˜“ç­–ç•¥
```

### 6. å›æ¸¬ç³»çµ±

#### é€šéèŠå¤©ç•Œé¢é‹è¡Œå›æ¸¬

**è‡ªç„¶èªè¨€è¼¸å…¥ï¼š**
```
å›æ¸¬ MACD ç­–ç•¥
å° BTC/USDT é‹è¡Œæƒ…æ„Ÿåˆ†æç­–ç•¥çš„å›æ¸¬
æ¸¬è©¦æ©Ÿå™¨å­¸ç¿’ç­–ç•¥çš„æ•ˆæœ
```

#### é€šéå›æ¸¬é é¢é‹è¡Œ

1. è¨ªå• `http://localhost:11403/backtest`
2. é¸æ“‡åƒæ•¸ï¼š
   - äº¤æ˜“å°ï¼ˆBTC/USDT, ETH/USDTç­‰ï¼‰
   - æ™‚é–“é€±æœŸï¼ˆ1h, 4h, 1dï¼‰
   - ç­–ç•¥é¡å‹ï¼ˆsentiment, macd, mlï¼‰
   - åˆå§‹è³‡é‡‘ï¼ˆé è¨­ 10000 USDTï¼‰
3. é»æ“Šã€Œé–‹å§‹å›æ¸¬ã€
4. æŸ¥çœ‹çµæœ

#### å›æ¸¬ç¸¾æ•ˆæŒ‡æ¨™

| æŒ‡æ¨™ | èªªæ˜ | è‰¯å¥½å€¼ |
|------|------|--------|
| ç¸½å›å ±ç‡ | ç­–ç•¥çš„ç´¯è¨ˆæ”¶ç›Š | > 0% |
| å¤æ™®æ¯”ç‡ | é¢¨éšªèª¿æ•´å¾Œæ”¶ç›Š | > 1.0 |
| æœ€å¤§å›æ’¤ | æœ€å¤§è™§æå¹…åº¦ | < 20% |
| å‹ç‡ | ç›ˆåˆ©äº¤æ˜“ä½”æ¯” | > 50% |
| ç¸½äº¤æ˜“æ¬¡æ•¸ | ç­–ç•¥åŸ·è¡Œæ¬¡æ•¸ | é©ä¸­ |

### 7. å¯ç”¨çš„äº¤æ˜“ç­–ç•¥

#### æƒ…æ„Ÿåˆ†æç­–ç•¥ï¼ˆSentiment Strategyï¼‰
```python
ç‰¹é»ï¼š
- çµåˆæ–°èæƒ…æ„Ÿèˆ‡æŠ€è¡“æŒ‡æ¨™
- åœ¨æƒ…æ„Ÿç©æ¥µä¸” RSI è¶…è³£æ™‚è²·å…¥
- åœ¨æƒ…æ„Ÿæ¶ˆæ¥µä¸” RSI è¶…è²·æ™‚è³£å‡º
- æ”¯æ´é»ƒé‡‘äº¤å‰/æ­»äº¡äº¤å‰ä¿¡è™Ÿ

åƒæ•¸ï¼š
- sentiment_threshold: 0.2ï¼ˆæƒ…æ„Ÿé–¾å€¼ï¼‰
- rsi_period: 14
- rsi_overbought: 70
- rsi_oversold: 30
```

#### MACD ç­–ç•¥
```python
ç‰¹é»ï¼š
- åŸºæ–¼ MACD æŒ‡æ¨™çš„ç¶“å…¸ç­–ç•¥
- MACD ç·šä¸Šç©¿ä¿¡è™Ÿç·šæ™‚è²·å…¥
- MACD ç·šä¸‹ç©¿ä¿¡è™Ÿç·šæ™‚è³£å‡º

åƒæ•¸ï¼š
- fast_period: 12
- slow_period: 26
- signal_period: 9
```

#### æ©Ÿå™¨å­¸ç¿’ç­–ç•¥ï¼ˆML Strategyï¼‰
```python
ç‰¹é»ï¼š
- åŸºæ–¼æ·±åº¦å­¸ç¿’åƒ¹æ ¼é æ¸¬
- é æ¸¬ä¸Šæ¼²è¶…éé–¾å€¼æ™‚è²·å…¥
- é æ¸¬ä¸‹è·Œè¶…éé–¾å€¼æ™‚è³£å‡º

åƒæ•¸ï¼š
- prediction_threshold: 0.02ï¼ˆ2%ï¼‰
```

## API åƒè€ƒ

### èŠå¤© API
```bash
POST /api/chat
Content-Type: application/json

{
  "message": "æŸ¥è©¢ BTC çš„åƒ¹æ ¼"
}

Response:
{
  "success": true,
  "message": "AI å›æ‡‰å…§å®¹",
  "thinking": "æ€è€ƒéç¨‹",
  "tool_used": "get_crypto_price",
  "tool_result": {...}
}
```

### åƒ¹æ ¼æŸ¥è©¢ API
```bash
GET /api/price/BTC/USDT

Response:
{
  "success": true,
  "symbol": "BTC/USDT",
  "price": 411403.00,
  "change_24h": 2.5,
  "volume_24h": 1000000000
}
```

### å›æ¸¬ API
```bash
POST /api/backtest/run
Content-Type: application/json

{
  "symbol": "BTC/USDT",
  "timeframe": "1h",
  "strategy": "sentiment",
  "initial_capital": 10000
}

Response:
{
  "success": true,
  "strategy": "sentiment",
  "total_return_pct": 15.5,
  "sharpe_ratio": 1.8,
  "max_drawdown_pct": 12.3,
  "win_rate": 55.0
}
```

### ç¶œåˆåˆ†æ API
```bash
POST /api/analysis/combined
Content-Type: application/json

{
  "symbol": "BTC/USDT",
  "timeframe": "1h"
}
```

## å¸¸è¦‹å•é¡Œ

### Q1: å¦‚ä½•æ›´æ›æ¨¡å‹ï¼Ÿ
A: ç·¨è¼¯ `config.py` ä¸­çš„ `OLLAMA_MODEL` åƒæ•¸

### Q2: å¦‚ä½•æ·»åŠ æ›´å¤šäº¤æ˜“æ‰€ï¼Ÿ
A: CCXT æ”¯æ´ 100+ äº¤æ˜“æ‰€ï¼Œä¿®æ”¹ `crypto_tools.py` ä¸­çš„ exchange é…ç½®

### Q3: å›æ¸¬çµæœä¿å­˜åœ¨å“ªè£¡ï¼Ÿ
A: `data/backtest_results.json`

### Q4: å¦‚ä½•èª¿æ•´ç­–ç•¥åƒæ•¸ï¼Ÿ
A: ä¿®æ”¹ `backtest_engine.py` ä¸­å°æ‡‰ç­–ç•¥é¡çš„ `params`

### Q5: FinBERT æ¨¡å‹åœ¨å“ªè£¡ä¸‹è¼‰ï¼Ÿ
A: é¦–æ¬¡é‹è¡Œæ™‚è‡ªå‹•å¾ HuggingFace ä¸‹è¼‰åˆ° `~/.cache/huggingface/`

### Q6: å¦‚ä½•æé«˜é æ¸¬æº–ç¢ºåº¦ï¼Ÿ
A: 
- å¢åŠ è¨“ç·´æ•¸æ“šé‡
- èª¿æ•´æ¨¡å‹è¶…åƒæ•¸
- ä½¿ç”¨æ›´é•·çš„æ™‚é–“åºåˆ—
- çµåˆå¤šå€‹æ™‚é–“é€±æœŸ

### Q7: ç³»çµ±æ”¯æ´å¯¦æ™‚äº¤æ˜“å—ï¼Ÿ
A: ç•¶å‰ç‰ˆæœ¬åƒ…æ”¯æ´åˆ†æå’Œå›æ¸¬ï¼Œå¯¦æ™‚äº¤æ˜“éœ€è¦é¡å¤–é–‹ç™¼

## æ€§èƒ½å„ªåŒ–å»ºè­°

1. **ä½¿ç”¨ Redis ç·©å­˜**ï¼šç·©å­˜åƒ¹æ ¼æ•¸æ“šæ¸›å°‘ API èª¿ç”¨
2. **GPU åŠ é€Ÿ**ï¼šä½¿ç”¨ CUDA åŠ é€Ÿæ·±åº¦å­¸ç¿’æ¨ç†
3. **æ‰¹é‡è™•ç†**ï¼šä¸€æ¬¡æ€§åˆ†æå¤šå€‹å¹£ç¨®
4. **ç•°æ­¥ä»»å‹™**ï¼šä½¿ç”¨ Celery è™•ç†é•·æ™‚é–“å›æ¸¬

## å®‰å…¨å»ºè­°

1. **ä¸è¦æäº¤ .env æ–‡ä»¶**åˆ°ç‰ˆæœ¬æ§åˆ¶
2. **å®šæœŸæ›´æ› API å¯†é‘°**
3. **ä½¿ç”¨åªè®€ API å¯†é‘°**ï¼ˆå¦‚æœåƒ…åšåˆ†æï¼‰
4. **é™åˆ¶ API èª¿ç”¨é »ç‡**é¿å…è¢«å°ç¦
5. **ä¸è¦åœ¨ç”Ÿç”¢ç’°å¢ƒé–‹å•Ÿ DEBUG æ¨¡å¼**

## æ•…éšœæ’é™¤

### å•é¡Œï¼šç„¡æ³•é€£æ¥ Ollama API
```bash
# æª¢æŸ¥ API Key
cat .env | grep OLLAMA_API_KEY

# æ¸¬è©¦é€£æ¥
curl -H "X-API-Key: YOUR_KEY" http://140.120.13.248:8787/ollama/
```

### å•é¡Œï¼šFinBERT æ¨¡å‹ä¸‹è¼‰å¤±æ•—
```bash
# æ‰‹å‹•ä¸‹è¼‰
python -c "from transformers import AutoModel; AutoModel.from_pretrained('ProsusAI/finbert')"
```

### å•é¡Œï¼šå›æ¸¬é‹è¡Œç·©æ…¢
- æ¸›å°‘æ•¸æ“šé‡ï¼ˆlimit åƒæ•¸ï¼‰
- ä½¿ç”¨è¼ƒå¤§çš„æ™‚é–“é€±æœŸ
- é—œé–‰å…¶ä»–è€—è³‡æºç¨‹åº

## é€²éšä½¿ç”¨

### è‡ªå®šç¾©æŠ€è¡“æŒ‡æ¨™
ç·¨è¼¯ `technical_analysis.py` çš„ `prepare_features` æ–¹æ³•æ·»åŠ æ–°æŒ‡æ¨™

### å‰µå»ºè‡ªå®šç¾©ç­–ç•¥
ç¹¼æ‰¿ `bt.Strategy` é¡ä¸¦å¯¦ç¾äº¤æ˜“é‚è¼¯

### æ•´åˆå…¶ä»–æ•¸æ“šæº
åœ¨ `crypto_tools.py` æ·»åŠ æ–°çš„æ•¸æ“šç²å–æ–¹æ³•

### éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
```bash
# ä½¿ç”¨ Gunicorn
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:11403 app:app

# ä½¿ç”¨ Nginx åå‘ä»£ç†
# é…ç½® SSL è­‰æ›¸
# è¨­ç½®é˜²ç«ç‰†è¦å‰‡
```

## ç²å–å¹«åŠ©

- æŸ¥çœ‹å®Œæ•´æ–‡æª”ï¼š`README.md`
- ç³»çµ±æ¶æ§‹èªªæ˜ï¼š`architecture.md`
- é‹è¡Œæ¸¬è©¦ï¼š`python test_demo.py`
- GitHub Issuesï¼šæäº¤å•é¡Œå’Œå»ºè­°

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼Happy Trading! ğŸš€ğŸ“ˆ**
