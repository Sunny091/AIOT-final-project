# 圖表功能使用指南 📊

## 概述

圖表工具可以生成時間序列的視覺化圖表，包括價格走勢圖、K線圖和自定義數據圖表。

## 功能特性

### 1. 價格走勢圖（折線圖）

顯示加密貨幣價格隨時間的變化趨勢。

**示例指令：**
- "顯示 BTC 過去一週的價格走勢圖"
- "繪製 ETH/USDT 的價格走勢"
- "顯示 BTC 最近24小時的價格變化"

**參數說明：**
- `symbol`: 交易對符號（如 BTC/USDT）
- `timeframe`: 時間週期（1m, 5m, 15m, 1h, 4h, 1d, 1w）
- `chart_type`: line（折線圖，默認）

### 2. K線圖（蠟燭圖）

顯示開盤價、收盤價、最高價、最低價的完整K線圖。

**示例指令：**
- "顯示 BTC/USDT 的K線圖"
- "繪製 ETH 4小時K線圖"
- "顯示 SOL/USDT 日K線"

**參數說明：**
- `symbol`: 交易對符號
- `timeframe`: 時間週期
- `chart_type`: candlestick（K線圖）

### 3. 自定義時間範圍

可以指定特定的開始和結束日期。

**示例指令：**
- "顯示 BTC 從 2024-12-01 到 2024-12-15 的價格走勢"
- "繪製 ETH 12月的價格圖表"

**參數說明：**
- `start_date`: 開始日期（格式：YYYY-MM-DD）
- `end_date`: 結束日期（格式：YYYY-MM-DD）

## 技術實現

### 前端

- **Plotly.js** - 互動式圖表庫
- 支援縮放、平移、hover 提示
- 響應式設計，自適應螢幕大小

### 後端

- **Chart Tool** (`backend/mcp_tools/chart_tool.py`)
  - 獲取歷史價格數據
  - 生成圖表配置
  - 格式化數據供前端渲染

### 整合流程

1. 用戶發送自然語言指令
2. LLM 識別需要使用 `create_chart` 工具
3. MCP Orchestrator 調用 Chart Tool
4. Chart Tool 獲取數據並生成圖表配置
5. 前端接收數據並使用 Plotly.js 渲染圖表

## 使用示例

### 示例 1：查看 BTC 價格趨勢

```
用戶: "顯示 BTC 過去一週的價格走勢圖"

系統回應:
- 💭 思考過程：用戶想查看 BTC 價格圖表
- 📊 圖表已生成
  - 標題: BTC/USDT 價格走勢 (1h)
  - 數據點數: 168
  - 類型: line
- [圖表顯示在上方]
```

### 示例 2：K線圖分析

```
用戶: "顯示 ETH 的4小時K線圖"

系統回應:
- 💭 思考過程：用戶想查看 ETH K線圖
- 📊 圖表已生成
  - 標題: ETH/USDT K線圖 (4h)
  - 數據點數: 180
  - 類型: candlestick
- [K線圖顯示在上方]
```

### 示例 3：特定時間範圍

```
用戶: "顯示 BTC 從 2024-12-01 到 2024-12-10 的價格變化"

系統回應:
- 💭 思考過程：用戶想查看特定時間範圍的價格
- 📊 圖表已生成
  - 標題: BTC/USDT 價格走勢
  - 數據點數: 216
  - 時間範圍: 2024-12-01 至 2024-12-10
- [圖表顯示在上方]
```

## 快速按鈕

在聊天界面的快速操作區有「價格走勢圖」按鈕，點擊可快速生成 BTC 過去一週的價格圖表。

## API 參數

### create_chart 工具參數

```json
{
  "data_source": "price",
  "symbol": "BTC/USDT",
  "timeframe": "1h",
  "start_date": "2024-12-01",  // 可選
  "end_date": "2024-12-15",     // 可選
  "chart_type": "line"          // line 或 candlestick
}
```

### 支援的時間週期

- `1m` - 1分鐘
- `5m` - 5分鐘
- `15m` - 15分鐘
- `30m` - 30分鐘
- `1h` - 1小時（默認）
- `4h` - 4小時
- `1d` - 1天
- `1w` - 1週

## 注意事項

1. **數據限制**：系統最多獲取 1000 個數據點
2. **實時更新**：圖表顯示歷史數據，不會自動更新
3. **瀏覽器支援**：建議使用 Chrome、Firefox、Safari 最新版本
4. **響應時間**：首次加載可能需要 2-5 秒獲取數據

## 進階功能

### 多幣種對比（計劃中）

```python
# 示例代碼
result = chart_tool.execute({
    'data_source': 'comparison',
    'symbols': ['BTC/USDT', 'ETH/USDT', 'BNB/USDT'],
    'timeframe': '1d',
    'days': 30
})
```

### 技術指標疊加（計劃中）

在圖表上顯示移動平均線、布林帶等技術指標。

## 故障排除

### 問題 1：圖表不顯示

**解決方法：**
- 檢查瀏覽器控制台是否有錯誤
- 確認 Plotly.js 已正確加載
- 重新整理頁面

### 問題 2：數據獲取失敗

**解決方法：**
- 檢查網路連接
- 確認交易對符號正確（如 BTC/USDT）
- 查看後端日誌

### 問題 3：圖表顯示不完整

**解決方法：**
- 調整時間範圍
- 減少數據點數量
- 使用較大的時間週期

## 更新日誌

### v1.0.0 (2024-12-16)
- ✅ 初始版本發布
- ✅ 支援價格走勢圖（折線圖）
- ✅ 支援 K線圖（蠟燭圖）
- ✅ 支援自定義時間範圍
- ✅ 整合到 MCP 架構
- ✅ 添加快速按鈕

## 參考資源

- [Plotly.js 官方文檔](https://plotly.com/javascript/)
- [CCXT 文檔](https://docs.ccxt.com/)
- [MCP 架構說明](PROJECT_STRUCTURE.md)
